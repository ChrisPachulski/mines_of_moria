#Packages####
install.packages("ggplot2")
install.packages("readr")
install.packages("reshape2")
install.packages("zoo")
install.packages("plyr")
install.packages("rlist")
install.packages("tidyr")
install.packages("fpp2")
install.packages("forecast")
install.packages("stats")
install.packages("tseries")
install.packages("data.table")
install.packages("gtools")
library(readr)
library(reshape2)
library(zoo)
library(plyr)
library(rlist)
library(dplyr)
library(tidyr)
library(fpp2)
library(forecast)
library(stats)
library(tseries)
library(data.table)
library(gtools)
#Exclusions####
moveme <- function (invec, movecommand) {
  movecommand <- lapply(strsplit(strsplit(movecommand, ";")[[1]], 
                                 ",|\\s+"), function(x) x[x != ""])
  movelist <- lapply(movecommand, function(x) {
    Where <- x[which(x %in% c("before", "after", "first", 
                              "last")):length(x)]
    ToMove <- setdiff(x, Where)
    list(ToMove, Where)
  })
  myVec <- invec
  for (i in seq_along(movelist)) {
    temp <- setdiff(myVec, movelist[[i]][[1]])
    A <- movelist[[i]][[2]][1]
    if (A %in% c("before", "after")) {
      ba <- movelist[[i]][[2]][2]
      if (A == "before") {
        after <- match(ba, temp) - 1
      }
      else if (A == "after") {
        after <- match(ba, temp)
      }
    }
    else if (A == "first") {
      after <- 0
    }
    else if (A == "last") {
      after <- length(myVec)
    }
    myVec <- append(temp, values = movelist[[i]][[1]], after = after)
  }
  myVec
}
Set_Excl = c("Throne of Eldraine",
             "Modern Horizons",
             "War of the Spark",
             "Core Set 2020",
             "Amonkhet",
             "Ravnica Allegiance",
             "2015 Core Set",
             "Dominaria",
             "2014 Core Set",
             "Commander 2019",
             "Guilds of Ravnica",
             "Khans of Tarkir",
             "Aether Revolt",
             "Theros",
             "Ixalan",
             "Kaladesh",
             "Fate Reforged",
             "Core Set 2019",
             "Unstable",
             "Return to Ravnica",
             "Rivals of Ixalan",
             "2013 Core Set",
             "Hour of Devastation",
             "Duel Decks: Elves Vs. Inventors",
             "Shadows Over Innistrad",
             "Eldritch Moon",
             "2011 Core Set",
             "Zendikar",
             "Future Sight",
             "Born of the Gods",
             "Ultimate Masters",
             "Iconic Masters",
             "Explorers of Ixalan",
             "Magic Origins",
             "Prophecy",
             "Dragons of Tarkir",
             "Dragon's Maze",
             "Gatecrash",
             "Innistrad",
             "Battle for Zendikar",
             "Ice Age",
             "Modern Masters 2015",
             "Chronicles",
             "Fifth Dawn",
             "Oath of the Gatewatch",
             "Champions of Kamigawa",
             "Journey into Nyx",
             "Commander 2018",
             "Worldwake",
             "Avacyn Restored",
             "New Phyrexia",
             "Commander 2014",
             "Dark Ascension",
             "Tempest",
             "Dissension",
             "2012 Core Set",
             "Battlebond",
             "Guildpact",
             "Commander 2017",
             "Time Spiral",
             "Visions",
             "Ravnica",
             "Masters 25",
             "Darksteel",
             "Shadowmoor",
             "Signature Spellbook: Gideon",
             "Scars of Mirrodin",
             "Rise of the Eldrazi",
             "Coldsnap",
             "Urza's Legacy",
             "Odyssey",
             "Legions",
             "Urza's Saga",
             "Mirrodin",
             "Global Series: Jiang Yanggu & Mu Yanling",
             "2010 Core Set",
             "Planar Chaos",
             "Mirrodin Besieged",
             "Morningtide",
             "Conspiracy",
             "Invasion",
             "Modern Masters 2017",
             "Conspiracy - Take the Crown",
             "Onslaught",
             "Conflux",
             "Eternal Masters",
             "Saviors of Kamigawa",
             "Torment",
             "Stronghold",
             "Planeshift",
             "Commander 2013",
             "Weatherlight",
             "Commander 2016",
             "Scourge",
             "Mirage",
             "Modern Masters",
             "Nemesis",
             "Unlimited",
             "Lorwyn",
             "Apocalypse",
             "Mercadian Masques",
             "Exodus",
             "Alara Reborn",
             "Betrayers of Kamigawa",
             "Urza's Destiny",
             "Legends",
             "Modern Event Deck",
             "Alliances",
             "Duel Decks: Mind Vs. Might",
             "Commander Anthology Vol. II",
             "Ravnica Allegiance: Guild Kits",
             "Commander",
             "Commander 2015",
             "Signature Spellbook: Jace",
             "Duel Decks: Zendikar Vs. Eldrazi",
             "Duel Decks: Nissa Vs. Ob Nixilis",
             "Homelands",
             "Duel Decks: Izzet Vs. Golgari",
             "Eventide",
             "The Dark",
             "Duel Decks: Blessed Vs. Cursed",
             "Chronicles",
             "Judgment",
             "Weatherlight",
             "Ice Age",
             "Duel Decks: Jace Vs. Vraska",
             "Planechase Anthology",
             "Fallen Empires",
             "10th Edition",
             "Duel Decks: Sorin Vs. Tibalt",
             "Archenemy - Nicol Bolas",
             "Antiquities",
             "Time Spiral",
             "Duel Decks: Speed Vs. Cunning",
             "Duel Decks: Knights Vs. Dragons",
             "Commander Anthology",
             "Duel Decks: Venser Vs. Koth",
             "Duel Decks: Elspeth Vs. Tezzeret",
             "Game Night",
             "Duel Decks: Elspeth Vs. Kiora",
             "Tempest",
             "Unglued",
             "Scourge",
             "Duel Decks: Heroes Vs. Monsters",
             "Portal",
             "Torment",
             "Fallen Empires",
             "Legions",
             "Stronghold",
             "Unhinged",
             "Shards of Alara",
             "3rd Edition",
             "Guilds of Ravnica: Guild Kits",
             "Nemesis",
             "Portal",
             "Odyssey",
             "Coldsnap",
             "7th Edition",
             "Urza's Saga",
             "Duel Decks: Jace Vs. Chandra",
             "Planechase 2012",
             "Archenemy",
             "6th Edition",
             "Duel Decks: Merfolk Vs. Goblins",
             "Duel Decks: Garruk Vs. Liliana",
             "Urza's Legacy",
             "Duel Decks: Phyrexia Vs. The Coalition",
             "Portal II",
             "5th Edition",
             "Onslaught",
             "Timeshifted",
             "4th Edition",
             "Legends",
             "Beatdown",
             "8th Edition",
             "Antiquities",
             "Prophecy",
             "Mercadian Masques",
             "Planechase",
             "Timeshifted",
             "Duel Decks: Ajani Vs. Nicol Bolas",
             "Duel Decks: Elves Vs. Goblins",
             "Mirage",
             "Battle Royale",
             "Duel Decks: Divine Vs. Demonic",
             "The Dark",
             "Starter 1999",
             "Apocalypse",
             "Starter 1999",
             "Urza's Destiny",
             "Homelands",
             "Portal 3K",
             "Battle Royale",
             "Starter 2000",
             "Visions",
             "Portal 3K",
             "Arabian Nights",
             "Portal II",
             "Unlimited",
             "Beta",
             "Beta",
             "Alpha",
             "Alpha",
             "World Championships",
             "Throne of Eldraine Variants",
             "Promotional",
             "Duel Decks: Anthology",
             "Anthologies",
             "Promo Pack",
             "Collectors Ed",
             "Magic Origins",
             "Conflux",
             "Journey into Nyx",
             "Commander 2019",
             "Ixalan",
             "Born of the Gods",
             "Rise of the Eldrazi",
             "Commander",
             "Amonkhet",
             "Return to Ravnica",
             "Avacyn Restored",
             "Innistrad",
             "Ravnica Allegiance",
             "Shadows Over Innistrad",
             "Dark Ascension",
             "Oath of the Gatewatch",
             "2014 Core Set",
             "Core Set 2019",
             "Dragons of Tarkir",
             "Dragon's Maze",
             "Dominaria",
             "Throne of Eldraine Variants",
             "Gatecrash",
             "Modern Masters 2015",
             "Unstable",
             "2012 Core Set",
             "2010 Core Set",
             "Commander 2014",
             "Iconic Masters",
             "Alara Reborn",
             "Guilds of Ravnica: Guild Kits",
             "Hour of Devastation",
             "Shards of Alara",
             "Modern Masters 2017",
             "Battle for Zendikar",
             "Ravnica Allegiance: Guild Kits",
             "Unstable",
             "Iconic Masters",
             "Khans of Tarkir",
             "2011 Core Set",
             "Promo Pack",
             "Promo Pack",
             "Commander 2018",
             "2012 Core Set",
             "Zendikar",
             "Worldwake",
             "Commander 2013",
             "Throne of Eldraine",
             "Signature Spellbook: Gideon",
             "6th Edition",
             "3rd Edition",
             "8th Edition",
             "7th Edition",
             "5th Edition",
             "9th Edition",
             "Collectors Ed Intl",
             "4th Edition",
             "Fate Reforged",
             "Judgment",
             "Onslaught",
             "Collectors Ed",
             "Collectors Ed Intl",
             "Alliances",
             "Collectors Ed",
             "Beta",
             "Exodus",
             "Anthologies",
             "Coldsnap Theme Decks",
             "3rd Edition",
             "5th Edition",
             "Mirage",
             "Unlimited",
             "6th Edition",
             "Tempest",
             "Urza's Legacy",
             "7th Edition",
             "Anthologies",
             "Antiquities",
             "Arabian Nights",
             "Coldsnap",
             "Collectors Ed Intl",
             "Beatdown",
             "Time Spiral",
             "Prophecy",
             "Legends",
             "Mercadian Masques",
             "Urza's Saga",
             "Coldsnap Theme Decks",
             "Starter 1999",
             "Urza's Destiny",
             "Nemesis",
             "Scourge",
             "Judgment",
             "Odyssey",
             "Starter 2000",
             "Torment",
             "Vanguard",
             "Vanguard",
             "Ice Age",
             "Game Night",
             "Eldritch Moon",
             "Scars of Mirrodin",
             "Throne of Eldraine Variants",
             "2015 Core Set",
             "Gatecrash",
             "Kaladesh",
             "War of the Spark",
             "Aether Revolt",
             "Rivals of Ixalan",
             "Core Set 2020",
             "Theros",
             "Guilds of Ravnica",
             "Journey into Nyx",
             "Ravnica Allegiance: Guild Kits",
             "Explorers of Ixalan",
             "Core Set 2020",
             "2015 Core Set",
             "Battle for Zendikar",
             "Explorers of Ixalan",
             "War of the Spark",
             "Ravnica Allegiance",
             "Ravnica",
             "Future Sight",
             "World Championships",
             "9th Edition",
             "8th Edition",
             "Promotional",
             "Commander 2017",
             "Commander 2015",
             "Commander Anthology Vol. II",
             "Champions of Kamigawa",
             "Planechase",
             "Unhinged",
             "Unglued",
             "Invasion",
             "10th Edition",
             "Planeshift",
             "Mirrodin",
             "Battlebond",
             "Duel Decks: Merfolk Vs. Goblins",
             "New Phyrexia",
             "Ultimate Masters",
             "Commander Anthology",
             "Duel Decks: Elves Vs. Goblins",
             "Duel Decks: Merfolk Vs. Goblins",
             "Duel Decks: Jace Vs. Vraska",
             "Duel Decks: Elves Vs. Inventors",
             "Shadowmoor",
             "Planechase Anthology",
             "Lorwyn",
             "Modern Masters",
             "Morningtide",
             "Commander 2016",
             "Guildpact",
             "Eventide",
             "Duel Decks: Nissa Vs. Ob Nixilis",
             "Duel Decks: Garruk Vs. Liliana",
             "Duel Decks: Mind Vs. Might",
             "Fifth Dawn",
             "Saviors of Kamigawa",
             "Avacyn Restored",
             "Planar Chaos",
             "Deckmaster",
             "Duel Decks: Izzet Vs. Golgari",
             "Masters 25",
             "Champions of Kamigawa",
             "Commander 2014",
             "2013 Core Set",
             "Conflux",
             "Duel Decks: Venser Vs. Koth",
             "Planar Chaos",
             "Archenemy",
             "Signature Spellbook: Jace",
             "Conspiracy",
             "Duels of the Planeswalkers",
             "Duel Decks: Elspeth Vs. Kiora",
             "Darksteel",
             "Duel Decks: Blessed Vs. Cursed",
             "Battle Royale",
             "Betrayers of Kamigawa",
             "Modern Masters",
             "Eternal Masters",
             "Duel Decks: Nissa Vs. Ob Nixilis",
             "Conspiracy - Take the Crown",
             "Duel Decks: Ajani Vs. Nicol Bolas",
             "Duel Decks: Anthology",
             "Fallen Empires",
             "Darksteel",
             "Mirrodin Besieged",
             "Planechase",
             "Unglued",
             "Commander Anthology Vol. II",
             "2011 Core Set",
             "Duel Decks: Speed Vs. Cunning",
             "Duel Decks: Phyrexia Vs. The Coalition",
             "Legions",
             "Archenemy - Nicol Bolas",
             "Commander 2018",
             "Global Series: Jiang Yanggu & Mu Yanling",
             "Dark Ascension",
             "Unhinged",
             "Promotional",
             "World Championships",
             "Planechase 2012",
             "2010 Core Set",
             "Archenemy",
             "Duel Decks: Divine Vs. Demonic",
             "Duel Decks: Jace Vs. Chandra",
             "Duel Decks: Sorin Vs. Tibalt",
             "Duel Decks: Elspeth Vs. Tezzeret",
             "Duel Decks: Knights Vs. Dragons",
             "Commander 2015",
             "Legions",
             "Masters 25",
             "Dissension",
             "Rise of the Eldrazi",
             "Modern Event Deck",
             "Commander",
             "Commander 2013",
             "Duel Decks: Heroes Vs. Monsters",
             "Eventide",
             "Magic Origins",
             "Modern Horizons",
             "Deckmaster",
             "Duel Decks: Mind Vs. Might",
             "Duel Decks: Zendikar Vs. Eldrazi",
             "Amonkhet",
             "Ravnica",
             "Shadowmoor",
             "Shadows Over Innistrad",
             "Throne of Eldraine",
             "Masterpiece Series: Mythic Edition",
             "Ultimate Masters",
             "10th Edition",
             "Art Series",
             "Hour of Devastation",
             "Invasion",
             "Shards of Alara",
             "Duel Decks: Blessed Vs. Cursed",
             "War of the Spark JPN Planeswalkers",
             "Planechase Anthology",
             "Duel Decks: Jace Vs. Chandra",
             "Aether Revolt",
             "Duel Decks: Zendikar Vs. Eldrazi",
             "Commander Anthology",
             "Commander 2016",
             "Duel Decks: Ajani Vs. Nicol Bolas",
             "Duel Decks: Izzet Vs. Golgari",
             "Duels of the Planeswalkers",
             "8th Edition",
             "The Dark",
             "Arabian Nights",
             "Invasion",
             "Portal II",
             "Weatherlight",
             "Alpha",
             "Timeshifted",
             "World Championships",
             "Deckmaster",
             "War of the Spark JPN Planeswalkers",
             "Masterpiece Series: Mythic Edition",
             "Vanguard",
             "Apocalypse",
             "Theros Beyond Death")
Excl_Excl <- c("Standard",
               "Modern",
               "Standard",
               "Standard",
               "Pioneer",
               "Standard",
               "Pioneer",
               "Pioneer",
               "Pioneer",
               "EDH",
               "Standard",
               "Pioneer",
               "Pioneer",
               "Pioneer",
               "Pioneer",
               "Pioneer",
               "Exclude",
               "Pioneer",
               "Unclear",
               "Pioneer",
               "Pioneer",
               "Modern",
               "Pioneer",
               "Unclear",
               "Pioneer",
               "Pioneer",
               "Modern",
               "Modern",
               "Modern",
               "Pioneer",
               "Modern",
               "EDH",
               "Pioneer",
               "Pioneer",
               "Exclude",
               "Pioneer",
               "Pioneer",
               "Pioneer",
               "Modern",
               "Pioneer",
               "Exclude",
               "Modern",
               "Exclude",
               "Modern",
               "Pioneer",
               "Modern",
               "Pioneer",
               "EDH",
               "Modern",
               "Modern",
               "Modern",
               "EDH",
               "Modern",
               "Exclude",
               "Modern",
               "Modern",
               "EDH",
               "Modern",
               "EDH",
               "Exclude",
               "Exclude",
               "Modern",
               "Modern",
               "Modern",
               "Modern",
               "EDH",
               "Modern",
               "Modern",
               "Exclude",
               "Exclude",
               "Exclude",
               "Unclear",
               "Exclude",
               "Modern",
               "EDH",
               "Modern",
               "Modern",
               "Modern",
               "Modern",
               "EDH",
               "Unclear",
               "Modern",
               "EDH",
               "Exclude",
               "EDH",
               "EDH",
               "Modern",
               "Exclude",
               "Exclude",
               "EDH",
               "EDH",
               "Exclude",
               "EDH",
               "Exclude",
               "Exclude",
               "Modern",
               "Exclude",
               "Exclude",
               "Modern",
               "Exclude",
               "Exclude",
               "Exclude",
               "Modern",
               "Modern",
               "Exclude",
               "Exclude",
               "Unclear",
               "Exclude",
               "Unclear",
               "EDH",
               "Pioneer",
               "EDH",
               "EDH",
               "EDH",
               "Unclear",
               "Unclear",
               "Exclude",
               "Unclear",
               "Modern",
               "Exclude",
               "Unclear",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Unclear",
               "EDH",
               "Unclear",
               "Modern",
               "Unclear",
               "EDH",
               "Exclude",
               "Exclude",
               "Unclear",
               "Unclear",
               "EDH",
               "Unclear",
               "Unclear",
               "Exclude",
               "Unclear",
               "Exclude",
               "Unclear",
               "Exclude",
               "Unclear",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Unclear",
               "Modern",
               "Exclude",
               "EDH",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Unclear",
               "EDH",
               "EDH",
               "Exclude",
               "Unclear",
               "Unclear",
               "Exclude",
               "Unclear",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "EDH",
               "Exclude",
               "Unclear",
               "Unclear",
               "Exclude",
               "Unclear",
               "Unclear",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Unclear",
               "Standard",
               "EDH",
               "Unclear",
               "Exclude",
               "EDH",
               "Exclude",
               "Pioneer",
               "EDH",
               "Pioneer",
               "EDH",
               "Pioneer",
               "Pioneer",
               "Modern",
               "EDH",
               "Pioneer",
               "Pioneer",
               "Modern",
               "Modern",
               "Standard",
               "Pioneer",
               "Modern",
               "Pioneer",
               "Pioneer",
               "Pioneer",
               "Pioneer",
               "Pioneer",
               "Pioneer",
               "Standard",
               "Pioneer",
               "Modern",
               "Unclear",
               "Modern",
               "Modern",
               "EDH",
               "EDH",
               "Modern",
               "EDH",
               "Pioneer",
               "Modern",
               "Modern",
               "Pioneer",
               "Pioneer",
               "Unclear",
               "EDH",
               "Pioneer",
               "Modern",
               "EDH",
               "EDH",
               "EDH",
               "Modern",
               "Modern",
               "Modern",
               "EDH",
               "Standard",
               "EDH",
               "Exclude",
               "Exclude",
               "Modern",
               "Exclude",
               "Exclude",
               "Modern",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Pioneer",
               "Modern",
               "Standard",
               "Pioneer",
               "Pioneer",
               "Pioneer",
               "Standard",
               "Pioneer",
               "Pioneer",
               "Standard",
               "Pioneer",
               "Standard",
               "Pioneer",
               "Pioneer",
               "Pioneer",
               "Standard",
               "Pioneer",
               "Pioneer",
               "Pioneer",
               "Standard",
               "Standard",
               "Modern",
               "Modern",
               "Unclear",
               "Modern",
               "Modern",
               "EDH",
               "EDH",
               "EDH",
               "EDH",
               "Modern",
               "EDH",
               "Unclear",
               "Unclear",
               "Unclear",
               "Modern",
               "EDH",
               "Modern",
               "EDH",
               "Unclear",
               "Modern",
               "Modern",
               "EDH",
               "Unclear",
               "Unclear",
               "Unclear",
               "Unclear",
               "Modern",
               "EDH",
               "Modern",
               "Modern",
               "Modern",
               "EDH",
               "Modern",
               "Modern",
               "Unclear",
               "Unclear",
               "Unclear",
               "Modern",
               "Modern",
               "Modern",
               "Modern",
               "Unclear",
               "Unclear",
               "Modern",
               "Modern",
               "EDH",
               "Modern",
               "EDH",
               "Unclear",
               "Modern",
               "EDH",
               "EDH",
               "EDH",
               "Unclear",
               "Unclear",
               "Modern",
               "Unclear",
               "Unclear",
               "Modern",
               "Modern",
               "EDH",
               "Unclear",
               "EDH",
               "Unclear",
               "Unclear",
               "Unclear",
               "Modern",
               "Modern",
               "EDH",
               "Unclear",
               "EDH",
               "Modern",
               "Unclear",
               "Unclear",
               "Unclear",
               "EDH",
               "EDH",
               "EDH",
               "Modern",
               "Unclear",
               "EDH",
               "Unclear",
               "EDH",
               "Modern",
               "EDH",
               "Unclear",
               "Unclear",
               "Unclear",
               "Unclear",
               "Unclear",
               "EDH",
               "Unclear",
               "Modern",
               "Modern",
               "Modern",
               "Unclear",
               "EDH",
               "EDH",
               "Unclear",
               "Modern",
               "Pioneer",
               "Modern",
               "Unclear",
               "Unclear",
               "Unclear",
               "Pioneer",
               "Modern",
               "Modern",
               "Pioneer",
               "Standard",
               "EDH",
               "Modern",
               "Modern",
               "Unclear",
               "Pioneer",
               "Unclear",
               "Modern",
               "Unclear",
               "Standard",
               "EDH",
               "Unclear",
               "Pioneer",
               "Unclear",
               "EDH",
               "EDH",
               "Unclear",
               "Unclear",
               "Unclear",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Exclude",
               "Standard",
               "EDH",
               "Exclude",
               "Exclude",
               "Standard")
Exclusion <- data.frame(Set_Excl,Excl_Excl, stringsAsFactors = TRUE)
#Exclusions Entered - Proceed####
#Foreplay - TS Formation from Tracker####
currentDate <- Sys.Date()
#Set Today's Date
#Three_Week_Movers <- paste("/home/cujo253/Reports/KPI/Master/",currentDate,"_Master_KPI.csv",sep ="")
Current_Buylist_Tracker <- paste("/home/cujo253/Metrics/TBD Updated Roster/",currentDate,"Vendor_History.csv", sep ="")
#Make it automate-able
Current_Buylist_Tracker <- read_csv(Current_Buylist_Tracker, col_types = cols(Foil = col_character()))

#Three_Week_Movers <- read_csv(Three_Week_Movers)
#Keys_Of_Interest <- Three_Week_Movers$Key
Keys_Of_Interest <- Current_Buylist_Tracker$Key
Keys_Of_Interest <- as.data.frame(Keys_Of_Interest)
colnames(Keys_Of_Interest) <- c("Key")
Keys_Of_Interest <- merge(Keys_Of_Interest,Current_Buylist_Tracker, by="Key")
#Pull it into a variable (ensure foil is as character)
data <- Keys_Of_Interest
data$Exclude <- Exclusion$Excl_Excl[match(data$Set, Exclusion$Set_Excl)]
data <- data[which(data$Exclude != "Exclude"),]
data <- data[-84]
#View(data)
#Convert to "data" for simplicity
data$Foil <- ifelse(is.na(data$Foil) == TRUE, "NF", data$Foil)
data <- data[which(data$Foil == "NF"),]
#data$Foil <- ifelse(is.na(data$Foil) == TRUE, "NF", data$Foil)
#Remove the Foils bc foils are gross
data <- data[which(data$Rarity == "M"),] #<- Rarity Selection Tool
trans_data <- t(data)
#Flip the data so the keys are on top
removed_data <- as.data.frame(trans_data)
headers <- removed_data[c(1:5),]
headers <- sapply(headers,as.character)
headers[5,][is.na(headers[5,])==TRUE]<- "Non-Foil"
headers <- as.data.frame(headers)
#Store the headers away to be repulled back in after transformation is complete
meaned_data <- as.data.frame(apply(removed_data[c(6:nrow(trans_data)),], 2, as.numeric))
#Ensure all Buy List values are numerical for calculation
meaned_data <- round(na.aggregate(meaned_data),2)
#If* cards have NA's, if there was no offer, the NA's will be filled in with the mean offer it has had in the time period selected
meaned_data <- sapply(meaned_data, as.factor)

Recombined_data <- rbind(headers, meaned_data)
Recombined_data <- as.data.frame(Recombined_data, stringsAsFactors = FALSE)

#Rejoined headers with numeric Values
Cleaned_Recombined_data <- Filter(function(Recombined_data) !any(Recombined_data=="NaN"), Recombined_data)
#Removed any lingering NaN's (potential for Inf & -Inf that would also need to be addressed should they arise)
names(Cleaned_Recombined_data) <- as.matrix(Cleaned_Recombined_data[1,])
ncol(Cleaned_Recombined_data)
Titless_Recombined_data <- Cleaned_Recombined_data[-c(1:5),]
ncol(Cleaned_Recombined_data)
ncol(Titless_Recombined_data)
#Once again, ax those headers for future ts conversion
values = seq(from = as.Date("2019-12-21"), to = currentDate, by = 'day')
Titless_Recombined_data$Dates <- values
col_idx <- grep("Dates", names(Titless_Recombined_data))
Titless_Recombined_data <- Titless_Recombined_data[, c(col_idx, (1:ncol(Titless_Recombined_data))[-col_idx])]
Buy_List_ts <- Titless_Recombined_data[,-1]
rownames(Buy_List_ts) <- Titless_Recombined_data[,1]
Buy_List_ts[] <- lapply( Buy_List_ts, function(x) as.numeric(as.character(x)))
library(TTR)
Buy_List_ts <- as.data.frame(Buy_List_ts)

ts_frequency_value <- ts_frequency_value-1
Buy_List_ts_final <- ts(Buy_List_ts, start=(1),frequency = 7)

Reformatted_Keys <- as.data.frame(t(Cleaned_Recombined_data[1,]))
Reformatted_Keys <- Reformatted_Keys[,1]
Reformatted_Keys <- as.data.frame(Reformatted_Keys)
total = nrow(Reformatted_Keys)

EMA_Final <- seq(from = as.Date("2019-12-21"), to = currentDate, by = 'day')
for(Key in Reformatted_Keys[c(1:total),]){
  desired_Column <- which( colnames(Buy_List_ts)== Key)
  bl_data_all <- window(Buy_List_ts_final[,desired_Column], start=c(1),freq=7)
  EMA_Model <- round(EMA(bl_data_all, n=7),0)
  EMA_Model <- as.data.frame(EMA_Model)
  EMA_Final <-cbind(EMA_Final,EMA_Model$EMA_Model)
}
EMA_Final <- na.omit(EMA_Final)
EMA_Final <- as.data.frame(EMA_Final)
EMA_Final <- EMA_Final[-1]
colnames(EMA_Final) <- Reformatted_Keys$Reformatted_Keys
#colnames(EMA_Final)[1] <- "Dates"
class(EMA_Final)
values = seq(from = as.Date("2019-12-27"), to = currentDate, by = 'day')
EMA_Final$Dates <- values
EMA_Final <- EMA_Final[moveme(names(EMA_Final), "Dates first")]
# EMA_Model <- EMA_Model[-nrow(EMA_Model),]
# training_rows <- round(nrow(EMA_Model)*.70,0)
# test_rows <- round(training_rows:nrow(EMA_Model),0)

GUI_Dataframe <- as.data.frame(EMA_Final)
# Allow Default X Axis Labels
library(scales)
library(ggplot2)
names <- colnames(GUI_Dataframe[c(1:nrow(GUI_Dataframe)),])
names <- as.data.frame(names)
#for(i in 2:ncol(GUI_Dataframe))
for(i in 2:ncol(GUI_Dataframe)){
  Key <- Reformatted_Keys[i,]
  desired_Column <- which(colnames(GUI_Dataframe)== Key)
  desired_Graph <- ggplot(GUI_Dataframe, 
                          aes(x=Dates, y= GUI_Dataframe[c(1:nrow(GUI_Dataframe)),i], label = GUI_Dataframe[c(1:nrow(GUI_Dataframe)),i])) + 
    geom_line(aes(y= GUI_Dataframe[c(1:nrow(GUI_Dataframe)),i]), colour="green", size = 1.25) + 
    geom_text(colour = "white",vjust = -.5, nudge_y = 0.1, size = 3.15,check_overlap = TRUE)+
    labs(title= names[i,], 
         subtitle="TCG Vendor Listings", 
         caption="Source: WolfofTinStreet", 
         y="$ Offers") +
    scale_x_date(breaks = "7 day", labels = date_format("%m-%d")) +
    theme(axis.text.x = element_text(angle = 90, vjust = 0.5)) +
    theme(plot.title = element_text(hjust = 0.5, size = 14),
          plot.subtitle = element_text(hjust = 0.5),
          plot.caption = element_text(hjust = 0, face = "italic", size = 10)) +
    theme(panel.background = element_rect(fill = "black", color = "black", size = .5, linetype = 'solid')) +
    theme(plot.background = element_rect(fill = "black", color = "black", size = .5, linetype = 'solid')) +
    theme(axis.text.x = element_text(color = "#4DBBD5B2",angle = 45, vjust=0.5),
          axis.text.y = element_text(color = "#4DBBD5B2", vjust=0.5)) +
    theme(axis.title.x = element_text(face = "bold", color = "#4DBBD5B2", vjust=0.5),
          axis.title.y = element_text(face = "bold", color = "#4DBBD5B2", vjust=0.5),
          plot.subtitle = element_text(face = "bold", color = "#4DBBD5B2", vjust=0.5),
          plot.caption = element_text(face = "bold", color = "Dark Grey", vjust=0.5),
          plot.title  = element_text(face = "bold", color = "#4DBBD5B2", vjust=0.5))+
    theme(panel.border = element_blank(), 
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          axis.line = element_line(colour = "white"))
  
  Title <- paste(names[i,],".png",sep="")
  ggsave(Title, plot = last_plot(), path = "/home/cujo253/Plots/Flat_Histories", width = 15,height = 5 , limitsize = T)
}

